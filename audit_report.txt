รายงานผลการตรวจสอบและการแก้ไขระบบ (Local Inventory Verification System)
วันที่ตรวจสอบ: 2026-02-15

ขอบเขตการตรวจสอบ
- Backend: API, ฐานข้อมูล, Export
- Frontend: Dashboard, Scanner, การสื่อสารกับ API
- Release Package: server.js, database.js

สรุปผลการตรวจสอบ (Findings)
1) ฐานข้อมูลกำหนด UNIQUE ที่ awb เพียงอย่างเดียว
   ผลกระทบ: ไม่สามารถอัปโหลด/สแกน AWB เดิมในคนละวันได้ ระบบรายวันผิดพฤติกรรมที่ออกแบบไว้
   Root Cause: การออกแบบคีย์หลักไม่รองรับข้อมูลแบบรายวัน (ควรใช้ awb + date)

2) Release package ใช้สคีมาเดียวกับ backend เดิม
   ผลกระทบ: ความผิดพลาดเดียวกันถูกส่งไปยังระบบใช้งานจริง
   Root Cause: ไม่มีขั้นตอนซิงค์สคีมา/โค้ดระหว่าง backend และ release

รายการแก้ไขที่ดำเนินการแล้ว
- ปรับสคีมาให้ UNIQUE(awb, date) และเพิ่ม migration อัตโนมัติเมื่อพบสคีมาเก่า
- เพิ่มดัชนี (awb, date) เพื่อให้ค้นหาได้เร็วและถูกต้อง
- อัปเดตคำสั่ง INSERT ให้ใช้ ON CONFLICT(awb, date) ทั้ง backend และ release

ขั้นตอนดำเนินงานที่ใช้ในการแก้ไข
1) ปรับสคีมาฐานข้อมูลให้รองรับคีย์แบบรายวัน
2) เพิ่มการย้ายข้อมูลอัตโนมัติจากสคีมาเก่าเป็นสคีมาใหม่
3) อัปเดตโค้ด backend/release ให้ตรงกับสคีมาใหม่
4) ทดสอบการทำงานในสภาพแวดล้อมทดสอบ

ผลการทดสอบในสภาพแวดล้อมทดสอบ
- npm test (backend): ผ่านทั้งหมด
- npm run lint (frontend): ผ่านทั้งหมด

ความเสี่ยง/ช่องว่างที่ยังพบ (แผนแก้ไขถัดไป)
- การตรวจสอบรูปแบบ AWB (Format Validation) ยังไม่มีสเปกที่ชัดเจน
  แผนแก้ไข: กำหนดรูปแบบ AWB ที่ต้องการ แล้วเพิ่ม validation ฝั่ง API และ UI
- สถานะการเชื่อมต่อเครื่องยิงบาร์โค้ดยังเป็นการประเมินจาก focus ของ input
  แผนแก้ไข: เพิ่มการบันทึกสถานะการเชื่อมต่อแบบ manual toggle หรือเชื่อมกับอุปกรณ์ผ่านโมดูลที่รองรับ

ข้อสรุป
ระบบสามารถทำงานได้ถูกต้องและมีเสถียรภาพตามการออกแบบในส่วนที่เกี่ยวข้องกับข้อมูลรายวันและการส่งออก โดยได้ทำการแก้ไขข้อบกพร่องหลักแล้ว และผ่านการทดสอบในสภาพแวดล้อมทดสอบเรียบร้อย
